# 人脸检测（深度学习方法）

人脸检测作为一种特定类型目标的检测任务，一方面具有其自己鲜明的特点，需要考虑人脸这一目标的特殊性，另一方面其也和其它类型目标的检测任务具有一定的共性，能够直接借鉴在通用目标检测方法上的研究经验。 
ksyfacedetection
### 神经网络与深度学习

神经网络是一种受大脑结构启发而设计出的层级模型，其由一系列按照一定规则相连接的节点组成，形成一种层次化的结构。[CS 231n](http://cs231n.github.io/neural-networks-1/)

![](http://cs231n.github.io/assets/nn1/neuron.png)
***

![](http://static.leiphone.com/uploads/new/article/740_740/201608/57ac3fc27ba4c.png?imageMogr2/format/jpg/quality/90)

神经网络有一个非常大的特点，就是非线性激活函数的引入和层层嵌套，这使得其能够表示高度非线性(相对于输入而言)的函数，因而对于复杂的数据变化模式具有更强的建模能力。

### CNN

在计算机视觉领域，应用最成功的一种神经网络是卷积神经网络（CNN），其最大的特点就是引入了卷积操作，将前馈网络中的全连接替换为局部连接，在不同的连接之间进行权值共享——将一个卷积核作用于一张图像时，卷积核就像检测时的观察窗口，其从图像的左上角逐步滑动到右下角，其滑动的每个位置对应于一个输出节点，这个节点只和窗口内的输入节点（图像上每一个点都对应于一个输入节点）相连接，而不同输出节点和对应输入节点连接的权值是相同的。

卷积神经网络在处理图像问题上具有得天独厚的优势，因为卷积操作可以自然地保留图像的空间信息，其只作用域局部，因而输出节点的空间结构和输入节点的空间结构是对应的。[CNNs/ConvNets](http://cs231n.github.io/convolutional-networks/)
![](http://cs231n.github.io/assets/cnn/convnet.jpeg)

### RCNN

R-CNN，其中R对应于“Region(区域)”，意指CNN以图像区域作为输入。

#####检测方法变革：

	1.抛弃了滑动窗口范式，取而代之的是一个新的生成候选窗口的环节。
	
Selective Search是一种典型的候选窗口生成方法，其采用了图像分割的思路，简单地说，Selective Search方法先基于各种颜色特征将图像划分为多个小块，然后自底向上地对不同的块进行合并，在这个过程中，合并前后的每一个块都对应于一个候选窗口，最后挑出最有可能包含待检测目标的窗口作为候选窗口。

	2.不再采用人工设计的特征，而是用 CNN来自动学习特征。
1）避免了人工干预，解放了人力，而且有利于学习到更契合实际数据和目标的特征来，特征提取和分类两个环节可以相互促进，相辅相成。2）自动学习出的特征往往可解释性比较差，对训练集会产生一定程度的依赖。   

	3.引入了一个新的环节：边框回归。
边框回归指的是在给定窗口的基础上去预测真实检测框的位置和大小。边框回归一方面提供了一个新的角度来定义检测任务，另一方面对于提高检测结果的精确度有比较显著的作用。 

##### 目标检测流程

先采用如 Selective Search等方法生成候选窗口，然后用学习好的CNN提取候选窗口对应的特征，接着训练分类器基于提取的特征对候选窗口进行分类，最后对判别为人脸的窗口采用边框回归进行修正。

目标检测精度得到巨大提升，但具有较高的计算复杂度，检测速度较慢。

##### Fast R-CNN

	1.直接以整张图像作为输入，先得到整张图对应的卷积特征图，然后对于每一个候选窗口，在提取特征时直接去整张图对应的卷积特征图上取出窗口对应的区域，从而避免重复计算.
	2.SVD 的矩阵分解技术,在计算矩阵乘法时降低计算量的目的，通过将 SVD应用于全连接层的权值矩阵.
	3.采用 CNN 来生成候选窗口，同时让其和分类、边框回归所使用的 CNN 共享卷积层，这样使得两个步骤中可以使用同样的卷积特征图，从而极大地减少计算量。  
	4.检测的框架和网络结构变化。进行特征提取（CNN），对窗口进行分类（SVM），边框回归三个模块合并成了一个模块，全部都用CNN来完成。只剩下两个模块：一个模块生成候选窗口，另一个模块直接对窗口进行分类和修正。 到Faster CNN，将生成候选框也合并到一起。

![](http://static.leiphone.com/uploads/new/article/740_740/201608/57ac3fd65e7d7.png?imageMogr2/format/jpg/quality/90)

### 全卷积网络（FCN）

CNN中不仅包含卷积层，也包含全连接层，全连接层的坏处就在于其会破坏图像的空间结构。用卷积层来“替代”全连接层，通常采用1 × 1的卷积核，这种不包含全连接层的CNN称为全卷积网络（FCN）。

	FCN 的特点就在于输入和输出都是二维的图像，并且输出和输入具有相对应的空间结构。

![](http://static.leiphone.com/uploads/new/article/740_740/201608/57ac3fd7d1254.png?imageMogr2/format/jpg/quality/90)

## 基于CNN的人脸检测

通用的目标检测器可以直接通过人脸图像来学习从而得到人脸检测器，虽然它们没有考虑人脸本身的特殊性，但是也能够获得非常好的精度。
FacenessNet是专门针对人脸设计的一个检测器，其考虑了头发、眼睛、鼻子、嘴巴和胡子这五个脸部特征，简单地说，对于一个候选窗口，FacenessNet 先分析这五个部分是否存在，然后再进一步判断是不是一张人脸。

![](http://static.leiphone.com/uploads/new/article/740_740/201608/57ac3fd97115a.png?imageMogr2/format/jpg/quality/90)

这种方法一方面同时利用了整体和局部的信息，能够从不同的角度对图像内容进行刻画，使得人脸和非人脸能够更好地被区分；另一方面增强了对遮挡的鲁棒性，人脸的局部遮挡会影响整体表现出的特征，但是并不会对所有的局部区域造成影响，因而增强了检测器对遮挡的容忍度。

***
 
 深度学习降低了各种目标检测技术的门槛。在精度方面，相比于非深度学习方法的检测器，基于深度学习的检测器在起点上就高出一截。缺点是检测速度还难以达到实际应用的需求。
 
## 传统人脸检测技术和CNN的结合

传统的人脸检测技术优势在于速度，而在精度上则相比基于深度网络的方法要略输一筹。

##### Cascade CNN

和VJ人脸检测器一样，其包含了多个分类器，这些分类器采用级联结构进行组织，然而不同的地方在于，Cascade CNN采用CNN作为每一级的分类器，而不是用AdaBoost方法通过多个弱分类器组合成的强分类器，并且也不再有单独的特征提取过程，特征提取和分类都由CNN来统一完成。Cascade CNN中还采用了一些其它的技术来保证检测的精度和速度，如多尺度融合、边框校准、非极大值抑制等。

***

	虽然基于深度网络的检测器目前能够达到很高的检测精度，并且其通用性非常强，但其所付出的计算代价也非常高，因此这类检测器突破的关键在于深度网络的简化和加速。此外，针对特定的问题，可能直接学习一个小型的网络就能足够好地完成这个任务。

